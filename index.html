<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¯Ù„ÙŠÙ„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: 'Tajawal', sans-serif; }
  </style>
</head>

<body class="bg-gray-50">

  <div class="max-w-3xl mx-auto mt-10 p-6">
    <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
      ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø´Ø±ÙƒØ§Øª ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚
    </h1>

    <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« -->
    <div class="relative mb-6">
      <input id="q"
        type="text"
        placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚â€¦"
        class="w-full p-4 rounded-xl border text-lg border-gray-300 focus:outline-none shadow-sm">

      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª -->
      <div id="suggestions"
           class="bg-white shadow-xl rounded-xl border border-gray-200 hidden absolute w-full mt-1 z-50 max-h-64 overflow-y-auto"></div>
    </div>

    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div id="results"></div>
  </div>

  <script>

  const API_URL = "https://script.google.com/macros/s/AKfycbx1KTtXXjV8s5s26fAmrF2MVqnaVUbsmApVbacMeXvLGVcrfZ6pdVqAxnUbzCpqPNrCug/exec";
  const API_KEY = "123";

  const q = document.getElementById("q");
  const results = document.getElementById("results");
  let allHotels = [];

  //-----------------------------------------
  // JSONP Fetch
  //-----------------------------------------
  function jsonpFetch(url){
    return new Promise(resolve => {
      const callback = "cb_" + Math.random().toString(36).substring(2);
      window[callback] = data => {
        resolve(data);
        script.remove();
      };
      const script = document.createElement("script");
      script.src = `${url}&callback=${callback}`;
      document.body.appendChild(script);
    });
  }

  //-----------------------------------------
  // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ ÙƒØ§Ù…Ù„Ø©
  //-----------------------------------------
  async function loadHotelsList(){
    const url = `${API_URL}?action=getAllHotels&key=${API_KEY}`;
    const data = await jsonpFetch(url);
    allHotels = data.list || [];
  }
  loadHotelsList();

  //-----------------------------------------
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
  //-----------------------------------------
  function showSuggestions(text){
    const box = document.getElementById("suggestions");

    if(!text || text.length < 2){
      box.classList.add("hidden");
      return;
    }

    const filtered = allHotels.filter(h =>
      h.toLowerCase().includes(text.toLowerCase())
    );

    if(filtered.length === 0){
      box.classList.add("hidden");
      return;
    }

    box.innerHTML = filtered
      .slice(0, 10)
      .map(item => `
        <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-700"
             onclick="selectSuggestion('${item}')">
          ${item}
        </div>
      `)
      .join("");

    box.classList.remove("hidden");
  }

  function selectSuggestion(name){
    q.value = name;
    document.getElementById("suggestions").classList.add("hidden");
    runSearch(name);
  }

  //-----------------------------------------
  // Ø¨Ø­Ø« ÙÙˆØ±ÙŠ Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
  //-----------------------------------------
  let typingTimer;
  function debounceSearch(){
    clearTimeout(typingTimer);
    typingTimer = setTimeout(() => {
      if(q.value.trim().length >= 2){
        runSearch(q.value.trim());
      }
    }, 300);
  }

  q.addEventListener("input", () => {
    showSuggestions(q.value.trim());
    debounceSearch();
  });

  //-----------------------------------------
  // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«
  //-----------------------------------------
  function runSearch(text){
    const url = `${API_URL}?action=getHotel&name=${encodeURIComponent(text)}&key=${API_KEY}`;

    results.innerHTML = `
      <div class="p-4 bg-white rounded-xl shadow text-center text-gray-600">
        â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«â€¦
      </div>`;

    jsonpFetch(url).then(data => render(data));
  }

  //-----------------------------------------
  // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  //-----------------------------------------
  function render(data){
    if(!data || !data.hotel){
      results.innerHTML = `
        <div class="p-5 bg-white rounded-xl shadow text-center text-red-600 font-bold">
          âŒ Ø§Ù„ÙÙ†Ø¯Ù‚ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
        </div>`;
      return;
    }

    const items = data.results || [];

    results.innerHTML = `
      <div class="bg-white rounded-xl shadow p-6">
        <h2 class="text-2xl font-bold mb-4 text-gray-700">ğŸ¨ ${data.hotel}</h2>

        ${items.map(company => `
          <div class="border rounded-xl p-4 mb-4 bg-gray-50">
            <h3 class="text-xl font-semibold text-blue-800 mb-2">
              ğŸ¢ ${company.company}
            </h3>

            ${company.phones.map(num => `
              <div class="flex items-center gap-3 mb-1 text-gray-700">
                <a href="tel:${num}" class="text-blue-600 underline text-lg">${num}</a>

                <a href="https://wa.me/${num.replace(/\D/g,'')}"
                   target="_blank"
                   class="text-green-600 text-2xl">
                  ğŸ’¬
                </a>
              </div>
            `).join("")}

            ${company.emails.map(mail => `
              <div>
                <a href="mailto:${mail}" class="text-purple-700 underline">${mail}</a>
              </div>
            `).join("")}
          </div>
        `).join("")}
      </div>
    `;
  }

  </script>

</body>
</html>
