<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¨Ø­Ø« Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ */
    #suggestionsBox {
      position: absolute;
      z-index: 1000;
      width: 100%;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-height: 220px;
      overflow-y: auto;
      display: none;
    }
    #suggestionsBox div:hover {
      background: #f1f5f9;
      cursor: pointer;
    }
  </style>
</head>

<body class="bg-gray-100">

  <div class="max-w-3xl mx-auto p-6 mt-10">

    <!-- Ø¹Ù†ÙˆØ§Ù† -->
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">
      ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø´Ø±ÙƒØ§Øª ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚
    </h1>

    <!-- Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« -->
    <div class="relative">
      <input id="searchInput"
             type="text"
             placeholder="Ø£ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚â€¦"
             class="w-full p-4 text-lg border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
      <div id="suggestionsBox"></div>
    </div>

    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div id="results" class="mt-8 space-y-4"></div>

  </div>

<script>
// Ø±Ø§Ø¨Ø· API
const API_URL = "https://script.google.com/macros/s/AKfycbx1KTtXXjV8s5s26fAmrF2MVqnaVUbsmApVbacMeXvLGVcrfZ6pdVqAxnUbzCpqPNrCug/exec?hotel=";

//===============*
//   Live Search
//===============*

const input = document.getElementById("searchInput");
const suggestionsBox = document.getElementById("suggestionsBox");

// ØªØ®Ø²ÙŠÙ† ÙƒÙ„ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ Ù„Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ
let hotelList = [];

// Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
async function loadHotelsList() {
  try {
    const response = await fetch(API_URL + "all");
    const data = await response.json();

    hotelList = [...new Set(data.map(d => d.hotel))]; // Ù‚Ø§Ø¦Ù…Ø© ÙØ±ÙŠØ¯Ø©
  } catch (e) {
    console.error("Error loading hotel list", e);
  }
}

loadHotelsList();

// Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
input.addEventListener("input", () => {
  const value = input.value.trim();

  if (value.length < 2) {
    suggestionsBox.style.display = "none";
    return;
  }

  const suggestions = hotelList.filter(h =>
    h.toLowerCase().includes(value.toLowerCase())
  );

  if (suggestions.length === 0) {
    suggestionsBox.style.display = "none";
    return;
  }

  suggestionsBox.innerHTML = suggestions
    .map(s => `<div class="p-3 border-b">${s}</div>`)
    .join("");

  suggestionsBox.style.display = "block";
});

// Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
suggestionsBox.addEventListener("click", (e) => {
  input.value = e.target.innerText;
  suggestionsBox.style.display = "none";
  searchHotel();
});

//===============*
//  Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
//===============*
async function searchHotel() {
  const hotel = input.value.trim();
  if (!hotel) return;

  const resultsBox = document.getElementById("results");
  resultsBox.innerHTML = `<p class="text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«â€¦</p>`;

  try {
    const response = await fetch(API_URL + encodeURIComponent(hotel));
    const data = await response.json();

    if (data.length === 0) {
      resultsBox.innerHTML = `<p class="text-red-600 text-lg">âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>`;
      return;
    }

    resultsBox.innerHTML = data.map(d => createCompanyCard(d)).join("");

  } catch (error) {
    resultsBox.innerHTML = `<p class="text-red-600">âš  Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«</p>`;
  }
}

//===============*
// Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ø±ÙƒØ©
//===============*
function createCompanyCard(d) {
  // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª
  const emails = d.emails
    .map(email => `<a href="mailto:${email}" class="text-blue-600 underline">${email}</a>`)
    .join("<br>");

  // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
  const phones = d.phones.map(p => `
      <div class="flex items-center gap-2 mb-1">
        <a href="tel:${p}" class="text-green-700 font-bold underline">${p}</a>
        <a href="https://wa.me/${p.replace(/\D/g, '')}" target="_blank">
          <img src="https://img.icons8.com/color/28/whatsapp--v1.png"/>
        </a>
      </div>
  `).join("");

  return `
    <div class="bg-white p-5 rounded-xl shadow">
      <h2 class="text-xl font-bold text-blue-800">${d.company}</h2>

      <p class="mt-2 text-gray-600"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong><br>${emails}</p>

      <p class="mt-2 text-gray-600"><strong>Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</strong><br>${phones}</p>
    </div>
  `;
}

// Ø²Ø± Enter Ù„Ù„Ø¨Ø­Ø«
input.addEventListener("keyup", (e) => {
  if (e.key === "Enter") searchHotel();
});
</script>

</body>
</html>
