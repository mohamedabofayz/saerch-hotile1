<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>لوحة التحكم - إدارة</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6 font-sans">
  <div class="max-w-5xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold">لوحة التحكم — عرض كامل</h2>
      <div class="text-sm text-gray-600">عرض / ربط / نسخ معرّفات</div>
    </div>

    <div class="grid grid-cols-2 gap-6">
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-medium mb-2">قائمة الفنادق</h3>
        <div id="hotels" class="space-y-2 text-sm"></div>
      </div>

      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-medium mb-2">قائمة شركات التشغيل</h3>
        <div id="ops" class="space-y-2 text-sm"></div>
      </div>
    </div>

    <div class="mt-6 bg-white p-4 rounded shadow">
      <h3 class="font-medium mb-2">روابط</h3>
      <div id="links" class="text-sm"></div>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx1KTtXXjV8s5s26fAmrF2MVqnaVUbsmApVbacMeXvLGVcrfZ6pdVqAxnUbzCpqPNrCug/exec";
const API_KEY = "123";

async function loadAll(){
  const url = `${API_URL}?action=getAll&key=${encodeURIComponent(API_KEY)}`;
  const data = await jsonpFetch(url);
  if (data.error) {
    document.getElementById("hotels").textContent = data.error;
    return;
  }
  renderAll(data);
}

function renderAll(data){
  const hotelsEl = document.getElementById("hotels");
  const opsEl = document.getElementById("ops");
  const linksEl = document.getElementById("links");

  hotelsEl.innerHTML = data.hotels.map(h => `<div class="p-2 border rounded flex justify-between items-center">
    <div><strong>${h.hotelName}</strong><div class="text-xs text-gray-500">ID: ${h.hotelID}</div></div>
    <div><button onclick="copy('${h.hotelID}')" class="px-2 py-1 text-xs bg-gray-100 rounded">نسخ ID</button></div>
  </div>`).join("");

  opsEl.innerHTML = data.operators.map(o => `<div class="p-2 border rounded">
    <div class="flex justify-between items-center">
      <div><strong>${o.operatorName}</strong><div class="text-xs text-gray-500">ID: ${o.operatorID}</div></div>
      <div class="text-xs text-gray-600">${o.emails || '-'} / ${o.whatsapps || '-'}</div>
    </div>
  </div>`).join("");

  linksEl.innerHTML = data.links.map(l => `<div class="p-2 border rounded">Hotel: ${l.hotelID} ⇄ Operator: ${l.operatorID}</div>`).join("");
}

function copy(txt){
  navigator.clipboard.writeText(txt).then(()=> alert("تم نسخ: " + txt));
}

// JSONP helper
function jsonpFetch(url){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).substr(2,9);
    window[cb] = data => { resolve(data); delete window[cb]; script.remove(); };
    const script = document.createElement("script");
    script.src = url + (url.indexOf("?") === -1 ? "?" : "&") + "callback=" + cb;
    script.onerror = () => { reject(new Error("Network error")); delete window[cb]; script.remove(); };
    document.body.appendChild(script);
  });
}

// load on start
loadAll();
</script>
</body>
</html>
